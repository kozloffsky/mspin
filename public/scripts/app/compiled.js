jQuery.fn.loginPopup=function(j,d){settings=jQuery.extend({autoOpen:false,draggable:false,modal:true,resizable:false,minHeight:0},d);$(this).dialog(settings);jQuery.each(j,function(b,i){$(i).addClass("disabled");$(i).parent().submit(function(){$("#loginPopup").dialog("open");return false})});$(".tabs a[href!=/users/everyone]").click(function(){$("#loginPopup").dialog("open");return false});$("#homepage .buttons a[href!=/users/everyone]").click(function(){$("#loginPopup").dialog("open");return false});
$("#homepage .login").click(function(){$("#loginPopup").dialog("open");return false})};function Messenger(j){var d=jQuery.extend({messegerId:"statusMessage",messegerShowDelay:1E4},j);this.show=function(b,i){var m,k;if("message"==i){m="ui-icon-info";k="ui-state-highlight"}else{m="ui-icon-alert";k="ui-state-error"}$("#"+d.messegerId+" .ui-corner-all").addClass(k);$("#"+d.messegerId+" .ui-icon").addClass(m);$("#"+d.messegerId+" .message").html(b);setTimeout(function(){$("#"+d.messegerId).slideDown();setTimeout(function(){$("#"+d.messegerId).slideUp();$("#"+d.messegerId+" .ui-corner-all").removeClass(k);
$("#"+d.messegerId+" .ui-icon").removeClass(m);$("#"+d.messegerId+" .message").html("")},d.messegerShowDelay)},1)}};jQuery.fn.moodChooser=function(j){settings=jQuery.extend({limit:100},j);$(this).find("ul a").click(function(){return false});$(this).find("a.mood").click(function(){var d=this.href.split("#")[1]||0,b=$(this).parents("form");$(b).find(":input[name=mood_id]").val(d);d>1?$(b).find(":input[name=message]").val(this.title||""):$(b).find(":input[name=message]").val("");$(b).find(".avatar .overlay").hide();$(b).find(".avatar #overlay_"+d).show();return false});j=this.find(":input[name=mood_id]").val();$(this).find(".avatar #overlay_"+
j).show();$(this).find("textarea").limit(settings.limit,$(this).find(".counter .value"))};jQuery.fn.moodline=function(j){function d(c,e,n){var o=$.template('<p>${text}</p><ul><li><a target="_blank" href="http://twitter.com/${name}">Follow</a></li><li><a href="#RT@${name}">Re-Tweet</a></li><li><a href="#@${name}">Reply</a></li></ul>');return $("<div>").append(o,{name:c,text:e,mood:n})}var b=jQuery.extend({cell:{width:49,height:37},mood:{width:32,height:32},color:{height:23},dot:{width:12,height:12}},j),i=b.serviceUrl,m=b.user,k=function(c,e,n){$.post(e,{page:c,username:n},function(o){s(o)})},
s=function(c){c=eval(c);$("#moodline .date .date-interval").text(c[1].date);$("#moodline .markers").html("");$.each(c[0],p);$("#moodline .date .prev").unbind("click");$("#moodline .date .next").unbind("click");var e=c[1].page,n=c[1].current+1;$("#moodline tr span").removeClass("selected");n>0&&$("#moodline tr:eq("+n+") span").addClass("selected");if(e==0)$("#moodline .date .next").addClass("disabled");else{$("#moodline .date .next").removeClass("disabled");$("#moodline .date .next").click(function(o){o.preventDefault();
o.stopPropagation();k(c[1].page-1,i,m)})}$("#moodline .date .prev").click(function(o){o.preventDefault();o.stopPropagation();k(c[1].page+1,i,m)})},p=function(c,e){c=document.createElement("span");c.className=e.type;switch(e.type){case "mood":c.style.top=e.day*b.cell.height+(b.cell.height-b.mood.height)/2+"px";c.style.left=e.hours*b.cell.width/2+(b.cell.width-b.mood.width)/2+"px";c.style.backgroundImage="url(/images/moods/mood_"+e.moodId+".png)";break;case "color":c.style.top=e.day*b.cell.height+(b.cell.height-
b.color.height)/2+"px";c.style.left=e.hours*b.cell.width/2+b.cell.width/2+"px";if(e.duration*b.cell.width/2>0)c.style.width=e.duration*b.cell.width/2+"px";c.style.backgroundImage="url(/images/moods/moodline_"+e.moodId+".png)";break;case "dot":c.style.top=e.day*b.cell.height+(b.cell.height-b.dot.height)/2+"px";c.style.left=e.hours*b.cell.width/2+(b.cell.width-b.dot.width)/2+"px";break;default:break}$("#moodline .markers").append(c);var n=false;if(undefined!=e.messages&&e.messages){var o=$("<div></div>");
$.each(e.messages,function(v,f){if(f&&(f.text||f.mood_id>1)){n=true;v=d(m,f.text,f.mood_id);f.mood_id>1&&$(v).find("p").addClass("icon").css("background-image","url(../images/moods/mood_"+f.mood_id+".png)");$(o).append(v)}});if(n){$(c).addClass("hasTooltip");$(c).tooltips({setContent:$(o).html(),element:c,targetClass:".hasTooltip"})}}};k(0,i,m)};jQuery.fn.moodSelector=function(){function j(){var b=$(d).find("p");if(b){var i="",m=$(d).find(":checkbox[checked]").siblings("label");jQuery.each(m,function(k,s){i+=s.title+", "});i=i.substr(0,i.length-2);b.html(i)}}var d=this;j();$(this).find(".moods :checkbox").siblings("label").unbind("click").bind("click",function(){if($.browser.msie){$(this).siblings("input[type='checkbox']").trigger("click");$(this).siblings("input[type='checkbox']").trigger("change")}});$(this).find(".moods :checkbox").unbind("change").bind("change",
function(){$(this).parents("li").toggleClass("selected");j()})};jQuery.fn.network=function(j){function d(){i();m();k();s();b()}function b(){f.settings.useTooltips&&$(f.settings.tooltipWrapper).tooltips({targetClass:f.settings.tooltipTargetClass})}function i(){$(f).submit(function(g){g.preventDefault();v(true);$(f).submit();return true})}function m(){$(f).find(".results .prev").unbind("click").bind("click",function(){if($(this).hasClass("disabled"))return false;var g=$(this).parent().attr("rel"),a=$(this).parent().attr("rev");c(g,-1,a,this);return false})}function k(){$(f).find(".results .next").unbind("click").bind("click",
function(){if($(this).hasClass("disabled"))return false;var g=$(this).parent().attr("rel"),a=$(this).parent().attr("rev");c(g,1,a,this);return false})}function s(){$(f).find(".results .more").unbind("click").bind("click",function(){var g=$(this).parent().attr("rel");e(g,this);return false})}function p(g){$(f).find(".results .less").unbind("click").bind("click",function(){n(g);return false})}function c(g,a,h,l){$("body").mask(f.settings.maskMessage);$.post(settings.URL_GET_RESULTS,{"mood_id[]":g,results_type:"showResultsPage",
page_dir:a,offset:h},function(q){$("body").unmask();if(q){$(l).parent().after(""+q).remove();k();m();s();b()}else o("next")},"html")}function e(g,a){$("body").mask(f.settings.maskMessage);$.post(settings.URL_GET_RESULTS,{"mood_id[]":g,results_type:"showMoreResultsForMood"},function(h){$("body").unmask();$(a).parents("ul.results").html(""+h);p(f.settings.URL_GET_RESULTS);b()},"html")}function n(g){if(g)document.location.href=g;else return false}function o(g){$(f).find(".results ."+g).addClass("disabled")}
function v(g){if(g){$(f).find(".save").disabled=true;$(f).find(".cancel").disabled=true}else{$(f).find(".save").disabled=false;$(f).find(".cancel").disabled=false}}settings=jQuery.extend({URL_GET_RESULTS:"/my-network/results/",maskMessage:"Loading",useTooltips:false,tooltipWrapper:".results",tooltipTargetClass:".hasTooltip"},j);var f=this;f.settings=settings;d()};jQuery.fn.settings=function(j){j=$.extend({alertsCheckbox:"",alertsContainer:""},j||{});var d=$(this).find(j.alertsCheckbox),b=$(this).find(j.alertsContainer);d.is(":checked")?b.show():b.hide();d.unbind("click").bind("click",function(){d.is(":checked")?b.show():b.hide()})};jQuery.fn.tooltips=function(j){function d(){m=settings.element?$(settings.element):$(i).find(settings.targetClass);$(m).qtip({content:{text:settings.setContent?settings.setContent:settings.defaultContent,prerender:false},position:{corner:{target:"bottomMiddle",tooltip:"topMiddle"},adjust:{scroll:true,resize:true,screen:true}},style:{background:"#FFCC5C",width:{max:200,min:200},border:{width:3,radius:3,color:"#1B1B1B"},tip:{corner:"topMiddle",size:{x:9,y:5}}},show:{ready:false,solo:true},hide:{fixed:settings.tooltipFixed},
api:{beforeShow:function(){if(!settings.setContent){var k;k=$(this.elements.target).parents().find(settings.tooltipContent).html();k=jQuery.trim(k);if(!k)return false;this.updateContent(k,true)}settings.bindLinks==true&&b(this.elements.tooltip);return true}}})}function b(k){$(k).find("ul a").click(function(){var s=function(e){var n=document.createElement("div");n.innerHTML=e;e=n.childNodes[0].nodeValue;n.removeChild(n.firstChild);return e},p=this.href.split("#")[1];if(p){var c=$("#moodChooser textarea");
if(p.substr(0,2)=="RT"){p=p.substr(2,p.length-2);c.val(s("RT "+p+" "+$("p",this.parentNode.parentNode.parentNode).html()))}else c.val(p+" ");c.focus();return false}})}settings=jQuery.extend({setContent:"",element:null,defaultContent:"loading...",targetClass:".hasTooltip",tooltipContent:".tooltips",bindLinks:true,tooltipFixed:true},j||{});var i=this,m;d()};function Users(j){function d(){$("table.tablesorter th.sortable").addClass("header");var h=$("#filterForm input[name=sort]"),l=$("#filterForm input[name=sort_order]"),q=$(h).val(),r=$(l).val();if(q&&r){var t=$("table.tablesorter th[sort="+q+"]");if(t){var u="headerSortUp";if(r=="DESC")u="headerSortDown";$("table.tablesorter th.sortable").removeClass("headerSortUp");$("table.tablesorter th.sortable").removeClass("headerSortDown");$(t).addClass(u)}}$.each($("table.tablesorter th.sortable"),function(w,
x){$(x).unbind("click").bind("click",function(){var y=$(x).attr("sort");if(y==q)r=="DESC"?$(l).val("ASC"):$(l).val("DESC");else{$(h).val(y);$(l).val("ASC")}$("#filterForm").submit()})})}function b(h){h?$("."+a.usersActionsContainer+" .usersSending .messageSend").attr("disabled","disabled"):$("."+a.usersActionsContainer+" .usersSending .messageSend").removeAttr("disabled")}function i(h){if(h){$("."+a.buttonFollowUser).attr("disabled","disabled");$("."+a.buttonUnFollowUser).attr("disabled","disabled")}else{$("."+
a.buttonFollowUser).removeAttr("disabled","disabled");$("."+a.buttonUnFollowUser).removeAttr("disabled","disabled")}}function m(){$("#"+a.usersTableId+" input[type='checkbox']").unbind("change").bind("change",function(){if($("#"+a.usersTableId+" :checked").length){i(false);$("."+a.selectAllButtonClass).html("Deselect All")}else{i(true);$("."+a.selectAllButtonClass).html("Select All")}})}function k(){$("."+a.selectAllButtonClass).toggle(function(){$("#"+a.usersTableId+" input[type='checkbox']").attr("checked",
true);$("#"+a.usersTableId+" input[type='checkbox']").trigger("change");return false},function(){$("#"+a.usersTableId+" input[type='checkbox']").attr("checked",false);$("#"+a.usersTableId+" input[type='checkbox']").trigger("change");return false})}function s(){$("."+a.buttonFollowUser).unbind("click").bind("click",function(){var h=$("#"+a.usersTableId+" :checked");p(h,false)});$("."+a.buttonUnFollowUser).unbind("click").bind("click",function(){var h=$("#"+a.usersTableId+" :checked");p(h,true)})}function p(h,
l){var q=[];h&&$(h).each(function(r,t){q.push($(t).val())});if(q){i(true);$.post(a.urls.URL_FOLLOW,{"users[]":q,unfollow:l?1:0},function(r){i(false);$("#"+a.usersTableId+" input[type='checkbox']").trigger("change");$("#"+a.usersTableId+" input[type='checkbox']").attr("checked",false);if(r.error&&r.error.length){$(r.error).each(function(t,u){$("#"+a.usersTableId+" input[value='"+parseInt(u)+"']").attr("checked",true)});$("#"+a.usersTableId+" input[type='checkbox']").trigger("change");l?g(a.messages.ERROR_UNFOLLOW,
"error"):g(a.messages.ERROR_FOLLOW,"error")}else l?g(a.messages.OK_UNFOLLOW,"message"):g(a.messages.OK_FOLLOW,"message")},"json")}}function c(){$("."+a.usersActionsContainer+" .usersSending ."+a.messageTextClass).limit(a.consts.MESSAGE_MAX_LENGTH,".actionsContainer .usersSending ."+a.messageTextCharsCounterClass)}function e(){$("."+a.usersActionsContainer+" .usersSending ."+a.messageTextClass).unbind("keyup").bind("keyup",function(){$("#"+a.usersTableId+" :checked").length?b(false):b(true)})}function n(){$("."+
a.usersActionsContainer+" .usersSending .messageSend").unbind("click").bind("click",function(){var h=$.trim($("."+a.usersActionsContainer+" .usersSending .messageText").val()),l=$("#"+a.usersTableId+" :checked");h&&l.length&&$("#"+a.usersTableId+" :checked").length&&o(h,l)})}function o(h,l){var q=[],r=[];l&&$(l).each(function(t,u){q.push($(u).val());r.push($(u).attr("name"))});b(true);$.post(a.urls.URL_SEND_MESSAGE,{"users[]":q,"names[]":r,message:h},function(t){b(false);$("#"+a.usersTableId+" input[type='checkbox']").trigger("change");
$("#"+a.usersTableId+" input[type='checkbox']").attr("checked",false);if(t.error&&t.error.length){$(t.error).each(function(u,w){$("#"+a.usersTableId+" input[value='"+parseInt(w)+"']").attr("checked",true)});$("#"+a.usersTableId+" input[type='checkbox']").trigger("change");g(a.messages.ERROR_SEND_MESSAGE,"error")}else{g(a.messages.OK_SEND_MESSAGE,"message");$("."+a.usersActionsContainer+" .usersSending .messageText").val("")}},"json")}function v(){$("#"+a.moodContainerClass+" .resetMoods").unbind("click").bind("click",
function(){$("#"+a.moodContainerClass+" .mood").each(function(){$(this).removeClass("mood_shown");$(this).parent().find("input").attr("checked",false)})})}function f(){$("#"+a.moodContainerClass+" .mood").each(function(){$(this).toggle(function(){$(this).addClass("mood_shown");$(this).parent().find("input").attr("checked",true)},function(){$(this).removeClass("mood_shown");$(this).parent().find("input").attr("checked",false)})})}function g(h,l){(new Messenger).show(h,l)}var a=jQuery.extend({simple:false,
usersTableId:"registeredUsersTable",messageMaxLength:140,selectAllButtonClass:"usersSelectAll",messegerId:"statusMessage",messegerShowDelay:1E4,usersActionsContainer:"actionsContainer",buttonFollowUser:"buttonFollowUser",buttonUnFollowUser:"buttonUnFollowUser",messageTextClass:"messageText",messageTextCharsCounterClass:"messageCharsLeft",moodContainerClass:"moodContainer",moods:{},consts:{MESSAGE_MAX_LENGTH:140},urls:{URL_FOLLOW:"/admin/index/follow/",URL_SEND_MESSAGE:"/admin/index/send-message/"},
messages:{ERROR_FOLLOW:"Failed to follow selected people",ERROR_UNFOLLOW:"Failed to unfollow selected people",OK_FOLLOW:"OK to follow selected people",OK_UNFOLLOW:"OK to unfollow selected people",ERROR_SEND_MESSAGE:"Failed to send message to selected people",OK_SEND_MESSAGE:"OK to send message to selected people"}},j||{});this.init=function(){if(a.simple==false){k();m();s();c();e();n();v();f();$("#"+a.messegerId).hide();i(true);b(true);a.moods&&$(a.moods).each(function(h,l){$("#mood_"+parseInt(l)).parent().click()})}d()}}
;

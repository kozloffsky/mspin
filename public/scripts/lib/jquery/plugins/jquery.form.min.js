(function(b){function s(){b.fn.ajaxSubmit.debug&&window.console&&window.console.log&&window.console.log("[jquery.form] "+Array.prototype.join.call(arguments,""))}b.fn.ajaxSubmit=function(a){function d(){function n(){if(!z++){p.detachEvent?p.detachEvent("onload",n):p.removeEventListener("load",n,false);var q=true;try{if(A)throw"timeout";var m,o;o=p.contentWindow?p.contentWindow.document:p.contentDocument?p.contentDocument:p.document;if((o.body==null||o.body.innerHTML=="")&&!B){B=1;z--;setTimeout(n,
100);return}i.responseText=o.body?o.body.innerHTML:null;i.responseXML=o.XMLDocument?o.XMLDocument:o;i.getResponseHeader=function(D){return{"content-type":h.dataType}[D]};if(h.dataType=="json"||h.dataType=="script"){var t=o.getElementsByTagName("textarea")[0];i.responseText=t?t.value:i.responseText}else if(h.dataType=="xml"&&!i.responseXML&&i.responseText!=null)i.responseXML=x(i.responseText);m=b.httpData(i,h.dataType)}catch(E){q=false;b.handleError(h,i,"error",E)}if(q){h.success(m,"success");u&&b.event.trigger("ajaxSuccess",
[i,h])}u&&b.event.trigger("ajaxComplete",[i,h]);u&&!--b.active&&b.event.trigger("ajaxStop");if(h.complete)h.complete(i,q?"success":"error");setTimeout(function(){v.remove();i.responseXML=null},100)}}function x(q,m){if(window.ActiveXObject){m=new ActiveXObject("Microsoft.XMLDOM");m.async="false";m.loadXML(q)}else m=(new DOMParser).parseFromString(q,"text/xml");return m&&m.documentElement&&m.documentElement.tagName!="parsererror"?m:null}var j=g[0];if(b(":input[name=submit]",j).length)alert('Error: Form elements must not be named "submit".');
else{var h=b.extend({},b.ajaxSettings,a),r=b.extend(true,{},b.extend(true,{},b.ajaxSettings),h),y="jqFormIO"+(new Date).getTime(),v=b('<iframe id="'+y+'" name="'+y+'" src="about:blank" />'),p=v[0];v.css({position:"absolute",top:"-1000px",left:"-1000px"});var i={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;v.attr("src","about:blank")}},u=h.global;
u&&!b.active++&&b.event.trigger("ajaxStart");u&&b.event.trigger("ajaxSend",[i,h]);if(r.beforeSend&&r.beforeSend(i,r)===false)r.global&&b.active--;else if(!i.aborted){var z=0,A=0;if(r=j.clk){var C=r.name;if(C&&!r.disabled){a.extraData=a.extraData||{};a.extraData[C]=r.value;if(r.type=="image"){a.extraData[name+".x"]=j.clk_x;a.extraData[name+".y"]=j.clk_y}}}setTimeout(function(){var q=g.attr("target"),m=g.attr("action");j.setAttribute("target",y);j.getAttribute("method")!="POST"&&j.setAttribute("method",
"POST");j.getAttribute("action")!=h.url&&j.setAttribute("action",h.url);a.skipEncodingOverride||g.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});h.timeout&&setTimeout(function(){A=true;n()},h.timeout);var o=[];try{if(a.extraData)for(var t in a.extraData)o.push(b('<input type="hidden" name="'+t+'" value="'+a.extraData[t]+'" />').appendTo(j)[0]);v.appendTo("body");p.attachEvent?p.attachEvent("onload",n):p.addEventListener("load",n,false);j.submit()}finally{j.setAttribute("action",
m);q?j.setAttribute("target",q):g.removeAttr("target");b(o).remove()}},10);var B=0}}}if(!this.length){s("ajaxSubmit: skipping submit process - no element selected");return this}if(typeof a=="function")a={success:a};var c=b.trim(this.attr("action"));if(c)c=(c.match(/^([^#]+)/)||[])[1];c=c||window.location.href||"";a=b.extend({url:c,type:this.attr("method")||"GET"},a||{});c={};this.trigger("form-pre-serialize",[this,a,c]);if(c.veto){s("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(a.beforeSerialize&&
a.beforeSerialize(this,a)===false){s("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var f=this.formToArray(a.semantic);if(a.data){a.extraData=a.data;for(var e in a.data)if(a.data[e]instanceof Array)for(var l in a.data[e])f.push({name:e,value:a.data[e][l]});else f.push({name:e,value:a.data[e]})}if(a.beforeSubmit&&a.beforeSubmit(f,this,a)===false){s("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[f,this,a,c]);if(c.veto){s("ajaxSubmit: submit vetoed via form-submit-validate trigger");
return this}e=b.param(f);if(a.type.toUpperCase()=="GET"){a.url+=(a.url.indexOf("?")>=0?"&":"?")+e;a.data=null}else a.data=e;var g=this,k=[];a.resetForm&&k.push(function(){g.resetForm()});a.clearForm&&k.push(function(){g.clearForm()});if(!a.dataType&&a.target){var w=a.success||function(){};k.push(function(n){b(a.target).html(n).each(w,arguments)})}else a.success&&k.push(a.success);a.success=function(n,x){for(var j=0,h=k.length;j<h;j++)k[j].apply(a,[n,x,g])};e=b("input:file",this).fieldValue();l=false;
for(c=0;c<e.length;c++)if(e[c])l=true;if(a.iframe||l||0)a.closeKeepAlive?b.get(a.closeKeepAlive,d):d();else b.ajax(a);this.trigger("form-submit-notify",[this,a]);return this};b.fn.ajaxForm=function(a){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){b(this).ajaxSubmit(a);return false}).each(function(){b(":submit,input:image",this).bind("click.form-plugin",function(d){var c=this.form;c.clk=this;if(this.type=="image")if(d.offsetX!=undefined){c.clk_x=d.offsetX;c.clk_y=d.offsetY}else if(typeof b.fn.offset==
"function"){var f=b(this).offset();c.clk_x=d.pageX-f.left;c.clk_y=d.pageY-f.top}else{c.clk_x=d.pageX-this.offsetLeft;c.clk_y=d.pageY-this.offsetTop}setTimeout(function(){c.clk=c.clk_x=c.clk_y=null},10)})})};b.fn.ajaxFormUnbind=function(){this.unbind("submit.form-plugin");return this.each(function(){b(":submit,input:image",this).unbind("click.form-plugin")})};b.fn.formToArray=function(a){var d=[];if(this.length==0)return d;var c=this[0],f=a?c.getElementsByTagName("*"):c.elements;if(!f)return d;for(var e=
0,l=f.length;e<l;e++){var g=f[e],k=g.name;if(k)if(a&&c.clk&&g.type=="image"){if(!g.disabled&&c.clk==g){d.push({name:k,value:b(g).val()});d.push({name:k+".x",value:c.clk_x},{name:k+".y",value:c.clk_y})}}else if((g=b.fieldValue(g,true))&&g.constructor==Array)for(var w=0,n=g.length;w<n;w++)d.push({name:k,value:g[w]});else g!==null&&typeof g!="undefined"&&d.push({name:k,value:g})}if(!a&&c.clk){a=b(c.clk);f=a[0];if((k=f.name)&&!f.disabled&&f.type=="image"){d.push({name:k,value:a.val()});d.push({name:k+
".x",value:c.clk_x},{name:k+".y",value:c.clk_y})}}return d};b.fn.formSerialize=function(a){return b.param(this.formToArray(a))};b.fn.fieldSerialize=function(a){var d=[];this.each(function(){var c=this.name;if(c){var f=b.fieldValue(this,a);if(f&&f.constructor==Array)for(var e=0,l=f.length;e<l;e++)d.push({name:c,value:f[e]});else f!==null&&typeof f!="undefined"&&d.push({name:this.name,value:f})}});return b.param(d)};b.fn.fieldValue=function(a){for(var d=[],c=0,f=this.length;c<f;c++){var e=b.fieldValue(this[c],
a);e===null||typeof e=="undefined"||e.constructor==Array&&!e.length||(e.constructor==Array?b.merge(d,e):d.push(e))}return d};b.fieldValue=function(a,d){var c=a.name,f=a.type,e=a.tagName.toLowerCase();if(typeof d=="undefined")d=true;if(d&&(!c||a.disabled||f=="reset"||f=="button"||(f=="checkbox"||f=="radio")&&!a.checked||(f=="submit"||f=="image")&&a.form&&a.form.clk!=a||e=="select"&&a.selectedIndex==-1))return null;if(e=="select"){e=a.selectedIndex;if(e<0)return null;d=[];a=a.options;c=(f=f=="select-one")?
e+1:a.length;for(e=f?e:0;e<c;e++){var l=a[e];if(l.selected){var g=l.value;g||(g=l.attributes&&l.attributes.value&&!l.attributes.value.specified?l.text:l.value);if(f)return g;d.push(g)}}return d}return a.value};b.fn.clearForm=function(){return this.each(function(){b("input,select,textarea",this).clearFields()})};b.fn.clearFields=b.fn.clearInputs=function(){return this.each(function(){var a=this.type,d=this.tagName.toLowerCase();if(a=="text"||a=="password"||d=="textarea")this.value="";else if(a=="checkbox"||
a=="radio")this.checked=false;else if(d=="select")this.selectedIndex=-1})};b.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)this.reset()})};b.fn.enable=function(a){if(a==undefined)a=true;return this.each(function(){this.disabled=!a})};b.fn.selected=function(a){if(a==undefined)a=true;return this.each(function(){var d=this.type;if(d=="checkbox"||d=="radio")this.checked=a;else if(this.tagName.toLowerCase()=="option"){d=
b(this).parent("select");a&&d[0]&&d[0].type=="select-one"&&d.find("option").selected(false);this.selected=a}})}})(jQuery);
